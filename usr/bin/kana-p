#!/bin/sh

### Settings

xset b off
xset s off -dpms
xrdb -load /usr/share/kana-p/Xresources
synclient HorizTwoFingerScroll=1

export QT_STYLE_OVERRIDE=GTK+

export XDG_CONFIG_HOME="$HOME""/.config"
export XDG_CACHE_HOME="$HOME""/.cache"
export XDG_DATA_HOME="$HOME""/.local/share"
export XDG_DATA_DIRS="/usr/local/share:/usr/share"
export XDG_CONFIG_DIRS="/etc/xdg"

if [ ! -f "$HOME""/.xsettingsd" ]; then
	cp /usr/share/kana-p/xsettingsd "$HOME""/.xsettingsd"
fi
xsettingsd -c "$HOME""/.xsettingsd" &

### Drivers

kana-p-screen
srandrd kana-p-screen &

devmon --no-gui &
trap "killall devmon" EXIT

### Composition manager

compton -fcCz -r 8 -o 1.0 -l -9 -t -9 -I 0.08 -O 0.08 -D 20 --opacity-rule '92:class_g *?= "URxvt" && focused' --opacity-rule '65:class_g *?= "URxvt" && !focused' --blur-background --blur-kern 7x7box --blur-background-exclude '!class_g *?= "URxvt"' -b &

### Lock

xss-lock i3lock-wrapper -e &
trap "killall xss-lock" EXIT

### User scripts

if [ ! -f "$HOME""/.kana-p-startup" ]; then
	bash "$HOME""/.kana-p-startup"
fi

### WM

xdg_menu --format awesome --root-menu /etc/xdg/menus/arch-applications.menu > /tmp/kana-p-$USER-xdg_menu.lua
awesome -c /usr/share/kana-p/awesome/main.lua &

pid="$!"

sleep 0.5

dex -a -e Awesome

wait $pid
